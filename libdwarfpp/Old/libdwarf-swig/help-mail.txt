Hi,

I'm new to Swig, and am trying to use it to generate a Python wrapper
for the libdwarf library [1]. It's a C library which I want to wrap in
the object-oriented style. I'm having a problem wrapping opaque
structure types.

libdwarf is slightly unusual, in that it keeps some of its structure
definitions (typenames ending _s) totally opaque to the client.
libdwarf.h includes forward declarations for them, but no definitions.
The client's only means of accessing instances of these types is using
pointers passed/returned through the various functions in the libdwarf
API. 

I want to use %extend to add OO-like constructors and methods, so I have
a stanza like the following.

%extend Dwarf_Debug_s {
    Dwarf_Debug_s(int fd, Dwarf_Unsigned access,
        Dwarf_Handler errhand,
        Dwarf_Ptr errarg,
        Dwarf_Error *error) {
        
        Dwarf_Debug dbg; // handle on a Dwarf_Debug object        
        int retval;
        retval = dwarf_init(fd, access, errhand, errarg, &dbg, error);
        if (retval == DW_DLV_OK) return dbg;
        else return 0; // FIXME: we want to throw an exception
    }

	// ...
}

Unfortunately, I get the following warning when running Swig:

swig -I/home/srk31/opt/include -I/usr/include/python2.5 -python "libdwarf.i"
libdwarf.i:83: Warning(303): %extend defined for an undeclared class Dwarf_Debug_s.

..and the resulting wrapper does not contain a class definition for
Dwarf_Debug_s, whereas I'd hoped that it would. Note that Swig's message
isn't quite correct -- the class (or rather struct) *is* declared, it's
just not defined.

Am I taking the right approach here?  Does Swig really need a definition
of these types, when I'm defining the constructor and methods myself?
Note that dwarf_init is responsible for instantiating the structure on
the heap.

Any help or suggestions would be very gratefully received. Perhaps I
would be better off writing a C++ wrapper by hand, doing the same job as
%extend above, and then using Swig to wrap that...?

Thanks for reading.
Stephen

[1] http://reality.sgiweb.org/davea/dwarf.html
